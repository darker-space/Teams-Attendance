<%- include("./partials/header1.ejs") %>
    <!-- <link rel="stylesheet" href="/stylesheets/hospital.css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap" rel="stylesheet">
    <style>
        body{
            font-family: 'Montserrat', sans-serif;
            /* background-image: url(https://images.unsplash.com/photo-1537498425277-c283d32ef9db?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1957&q=80); */
           /* background-image: url(https://images.unsplash.com/photo-1588637382189-30b835216aef?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1927&q=80); */
        }
        #sub1:hover{
            font-size: 1.2em;
            color: cyan;
        }
      
        #guide1:hover{
            font-weight: 800;
            color:navy;
            background-color:rgba(172, 255, 47, 0.945);
            
        }
        
    </style>
 <%- include("./partials/header2.ejs")%>


 <% var sub; for(var i=0;i<userinfo.sub.length;i++){%>
 <%if(userinfo.sub[i]._id.equals(subject)){sub=userinfo.sub[i]; break;}  } %>
 
 <div class="jumbotron container-fluid p-4 text-center " style="background-color: #008080;" >
        <span class="display-3 text-light"><%= sub.name %> </span>
</div>
    
          <div class="text-center pb-3 mb-2">
            <h3 class="text-primary">
              Welcome <%= userinfo.name %> ...........!   
            </h3>
            <div class="container  d-flex justify-content-between">
              <a href="#" type="button" class="btn btn-light text-primary"  data-toggle="modal" data-target="#author"> Meet Developer...  :} </a>
              <a href="/user/logout" class="ml-3 btn btn-dark"> Logout</a>
            </div>
          </div>
          
              <!-- about Aothor -->
                          <!-- Modal -->
                          <div class="modal fade" id="author" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLongTitle">Hey There !</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <div class="card">
                                    <div class="card-body row">
                                      <div class="col-4">
                                        <div style="height:100px; width:100px; padding: 2px auto;">
                                          <img class="img-fluid" src="/uploads/me.jpg" alt="Card image cap">
                                          </div>
                                      </div>
                                        <div class="col-8 bg-light text-secondary">
                                          Hey There ! I am Aakash...
                                          I am 3rd year CSE student at BIT Mesra,Ranchi.<Br>
                                          Hope You feel amazing after using my website..
                                          Reach me out and share your reviews...Email me or ping me on LinkedIn..
                                          <br>
                                          :}
                                        </div>
                                      
                                    </div>
                                    <div class="card-footer"> 
                                      <i class="fas fa-envelope-open"></i> ak.grd.140@gmail.com
                                      <a class="mx-5" href="https://www.linkedin.com/in/aakash-a62b3b192/"><i class="text-info fab fa-linkedin-in"></i></a>
                                      <a class="ml-3" href="https://github.com/darker-space"><i class="text-info fab fa-github"></i> </a>
                                      
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
    
                          
      <!-- Guide popup -->
    <!-- Button trigger modal -->
    <div class="jumbotron container-fluid text-secondary text-center pt-3 pb-2 px-4">
        <button type="button" class="container-fluid btn btn-xl" id="guide1" style="background-color:rgba(172, 255, 47, 0.521);" data-toggle="modal" data-target="#guide">
            <span style="font-size: large; font-weight: 700;" >Guide..!</span>
           </button>
    </div>

  
  <!-- Modal -->
  <div class="modal fade" id="guide" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-primary" id="exampleModalLongTitle">Guide...!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <ul >
            <li>
                Make classes(subjects) and then upload .csv file of teams attendence to maintain students attendance.
              </li>
              <li>
                Choose min time that students must have to be online in meeting to get attandence.
              </li>
              <li>
                  View total no of classes and each student's total attendance.
              </li>
              <li>
                Kindly fill correct data while adding attendance like time and date .
            </li>
            <li>
             Do not alter Teams .csv file before uploading.
          </li>
            </ul>
            <p class="bg-light pt-3 text-secondary">
              <h3>Good Practices</h3>
              During team meeting kindly try to download attendance 5 min prior to scheduled end time of lecture.
              ( Microsoft Team .csv file stores all data for whole duration of lecture regarding which student were online for how much duration.)
            </p>
            <p class="text-success">
              For any further query please contact <i class="fas fa-envelope-open mx-2"></i> ak.grd.140@gmail.com
            </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
    <div class="container">
      <div class=" row mb-4 justify-content-around " style=" color: rgb(5, 77, 73);">
        <div class="col-4 border border-2 border-dark">
            
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><h2><b><%= sub.name %></b> </h2></li>
              <li class="list-group-item"> <%= sub.subject_id %> </li>
              <li class="list-group-item"> <%= sub.branch %> <%= sub.section %> </li>
              <li class="list-group-item"><%= sub.year %> </li>
            </ul>
                
        </div>
        <div class="col-4">
          <div class="list-group">
            <button type="button" class="list-group-item list-group-item-action"><b> Total Students= <%= Math.max(sub.students.size -1,0)%></b> </button>
            <button type="button" class="list-group-item list-group-item-action"><b>Total Classes= <%= sub.dates.length %></b> </button>
          </div>
        </div>
    </div>
    </div>
    <div class="d-flex justify-content-around py-3 bg-light mb-3">
      <button class="btn btn-lg btn-dark" type="button" data-toggle="collapse" data-target="#attend11" aria-expanded="false" aria-controls="collapseExample">
        View all Students Attendance
      </button>
      <button class="btn btn-lg btn-dark"  data-toggle="modal" data-target="#attendence">
        Add Attendance
      </button>
      
      
      <!-- Modal -->
      <div class="modal fade" id="attendence" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle"> Add Attendance</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item"><h2><b><%= sub.name %></b> </h2></li>
                <li class="list-group-item"> <%= sub.subject_id %> <%= sub.branch %> <%= sub.section %> <%= sub.year %></li>
              </ul>
              <% var s3=subject; s3="/attendence/"+s3;%> 
              <p class="text-danger">
                Kindly fill Correct Data....
              </p>
              <form action="<%= s3 %>" method="POST" enctype="multipart/form-data">
                <div class=" form-group">
                    <label>Choose Date of that lecture</label>
                    <input class="form-control form1 border-dark" type="date"  name="date1" required>
                </div>
                <div class=" form-group">
                  <label>Choose minimum time that students must have to be online to get attendance  (minutes)</label>
                  <select id="inputState" class="form-control" name="timing">
                    <option >55</option>
                    <option selected>50</option>
                    <option >45</option>
                    <option >40</option>
                    <option >35</option>
                    <option >30</option>
                    <option >20</option>
                    <option >10</option>
                  </select>
                 
              </div>
              <div class=" form-group">
                <label>Approx Starting time of Lecture </label>
                <select  class="form-control" name="start">
                  <option selected >9:00 am</option>
                  <option >10:15 am</option>
                  <option >11:30 am</option>
                  <option >12:45 pm</option> 
                  <option >2:00 pm</option>
                  <option >3:15 pm</option>
                  <option >4:30 pm</option>
                </select>
               
            </div>
                <div class=" form-group">
                    <label>Upload Microsoft Teams attendance .csv file here ! </label>
                    <input class="form-control form1 border-dark" type="file" placeholder="Upload" name="attendence_file" required>
                </div>

                <button  class="btn btn-primary">Submit</button>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      
      
    </div>
    </div>
    
  <div class="container">
    <div class="collapse border border-3 border-dark" id="attend11" class="card border-2 border border-dark">
      <div class="card-header"><h2>Students Attendance</h2></div>
      <div class="card-body">
        <table class="table">
          <thead class="thead-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Full Name</th>
              <th scope="col">Total Attendance</th>
            </tr>
          </thead>
          <tbody>
            <% var ii=parseInt(0); var obj=[]; %> 
            <%if(sub.students){sub.students.forEach(function(val,key,map){ obj.push([key,val])}); obj.sort(); obj.forEach(function(xx){ %> 
              <tr>
                <th scope="row"><%= ii%></th>
                <td><%= xx[0] %> </td>
                <td><%= xx[1] %> </td>
              </tr>
              <% ii++}) } %> 
          </tbody>
        </table>
        
        
      </div>
    </div>
  </div>
  
      
  <div class="container my-4">
    <div class=" border border-3 border-dark" id="attend11" class="card border-2 border border-dark">
      <div class="card-header "><h2>Total Classes <%=sub.dates.length %> </h2></div>
      <div class="card-body">
        <table class="table">
          <thead class="bg-danger text-light">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Date and Time </th>
              <th scope="col">Total Attendance</th>
              <th scope="col">Min required Time(for getting attendance)
                 
              </th>
              <th scope="col">Link</th>
            </tr>
          </thead>
          <tbody>
            <% var ii=parseInt(0);  %> 
            <%if(sub.dates){sub.dates.forEach(function(date1){ %> 
              <tr>
                <th scope="row"><%= ii+1%></th>
                <td><%= date1.date %> </td>
                <td> <%= Math.max(date1.students.length -1,0) %> </td>
                <td><%= date1.timing %> minutes 
                
                
                                    <button type="button" class="ml-4 text-center btn btn-dark btn-sm" id="deletee"  data-toggle="modal" data-target="#delete1">
                                      <i class="fas fa-trash text-light" ></i>
                                    </button>
                                    
                                    <div class="modal fade" id="delete1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                                      <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLongTitle">Are you Sure you want to delete this Date's Attendance ? <%=date1.date %> </h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                              <span aria-hidden="true">&times;</span>
                                            </button>
                                          </div>
                                          <div class="modal-footer">
                                            <% var xx=date1._id; xx="/date/delete/"+subject+"/"+xx; %> 
                                            <a href="<%= xx %>" type="button" class="btn btn-danger" >Delete</a>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                
                </td>
                <td>
                  
                  <button type="button" class="btn-dark btn btn-xl" id="guid" data-toggle="modal" data-target="#<%= date1._id %>">
                   View Students List
                   </button>
                
                
                <!-- Modal -->
                              <div class="modal fade" id="<%= date1._id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="exampleModalLongTitle">Students present on <%= date1.date %></h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                      <ul class="list-group list-group-flush">
                                        <% date1.students.forEach(function(name){ %> 
                                        <li class="list-group-item"><%= name %>  </li>
                                        <% }); %> 
                                      </ul>
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                            </td>
                
              </tr>
              <% ii++}) } %> 
          </tbody>
        </table>
        
        
      </div>
    </div>
  </div>
   
  <div class="container-fluid bg-dark text-center justify-content-around">

    <p>
      
      <button type="button" class="text-center btn btn-danger" id="deletee"  data-toggle="modal" data-target="#delete2">
        Delete this Class <i class="fas fa-trash text-light" ></i>
       </button>
      <!-- Button trigger modal -->
     
  </div>
    </p>
     <!-- Modal -->
                    <div class="modal fade" id="delete2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Are you Sure you want to delete this class ?</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-footer">
                            <% var xx=subject; xx="/class/delete/"+xx; %> 
                            <a href="<%= xx %>" type="button" class="btn btn-danger" >Delete</a>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          </div>
                        </div>
                      </div>
                    </div>
    
   
</div>
       <div style="height: 100px;">
           
       </div>

 
<%- include("./partials/footer1.ejs") %>
<!-- own scripts -->
<%- include("./partials/footer2.ejs") %>